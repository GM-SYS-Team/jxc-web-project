<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>客户端管理</title>
<link rel="stylesheet" type="text/css" href="/static/jquery-easyui-1.3.3/themes/default/easyui.css"></link>
<link rel="stylesheet" type="text/css" href="/static/jquery-easyui-1.3.3/themes/icon.css"></link>
<script type="text/javascript" src="/static/jquery-easyui-1.3.3/jquery.min.js"></script>
<script type="text/javascript" src="/static/jquery-easyui-1.3.3/jquery.easyui.min.js"></script>
<script type="text/javascript" src="/static/jquery-easyui-1.3.3/locale/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="/static/js/date.js"></script>
<script type="text/javascript">

	var url;
	
	function formatCreateTime(val,row){
		if(row.createTime!=null && row.createTime!=""){
			var createTime = new Date(row.createTime);
			return createTime.Format("yyyy-MM-dd hh:mm:ss");
		}
	}
	
	function resetSearchValue(){
		$("#s_name").val("");
		$("#s_btime").datetimebox("setValue","");
		$("#s_etime").datetimebox("setValue","");
	}
	
	function openAppAddDialog(){
		$("#dlg").dialog("open").dialog("setTitle","添加客户端");
		//$("#shopName").attr("readonly","");
		url="/admin/app/saveAndUpload";
	}
	
	function openAppModifyDialog(){
		var selectedRows=$("#dg").datagrid("getSelections");
		 if(selectedRows.length!=1){
			 $.messager.alert("系统提示","请选择一条要修改的数据！");
			 return;
		 }
		 var row=selectedRows[0];
		 $("#dlg2").dialog("open").dialog("setTitle","修改客户端信息");
		 $("#fm2").form("load",row);
		 //$("#shopName").attr("readonly","readonly");
		 url="/admin/app/modify?id="+row.id;
	}
	
	function saveApp2(){
		//置灰不可用
		 $("#dlg-buttons2 a:eq(0)").linkbutton('disable');
		 $("#fm2").form("submit",{
			url:url,
			onSubmit:function(){
				return $(this).form("validate");
			},
			success:function(result){
				var result=eval('('+result+')');
				if(result.success){
					$.messager.alert("系统提示","保存成功！");
					resetValue();
					$("#dlg2").dialog("close");
					$("#dg2").datagrid("reload");
				}else{
					$.messager.alert("系统提示",result.errorInfo);
				}
				$("#dlg-buttons2 a:eq(0)").linkbutton('enable');
			}
		 });
	}
	
	function saveApp(){
		//置灰不可用
		 $("#dlg-buttons a:eq(0)").linkbutton('disable');
		 $("#fm").form("submit",{
			url:url,
			onSubmit:function(){
				return $(this).form("validate");
			},
			success:function(result){
				var result=eval('('+result+')');
				if(result.success){
					$.messager.alert("系统提示","保存成功！");
					resetValue();
					$("#dlg").dialog("close");
					$("#dg").datagrid("reload");
				}else{
					$.messager.alert("系统提示",result.errorInfo);
				}
				$("#dlg-buttons a:eq(0)").linkbutton('enable');
			}
		 });
	}
	
	function closeAppDialog(){
		 $("#dlg").dialog("close");
		 resetValue();
		 $("#dlg-buttons a:eq(0)").linkbutton('enable');
	 }
	 function closeAppDialog2(){
		 $("#dlg2").dialog("close");
		 resetValue2();
		 $("#dlg-buttons2 a:eq(0)").linkbutton('enable');
	 }
	
	function resetValue(){
		 $("#appName").val("");
		 $("#appVersion").val("");
		 $("#remarks").val("");
		 $("#pictureFile").val("");
	}
	function resetValue2(){
		 $("#appName2").val("");
		 $("#appVersion2").val("");
		 $("#remarks2").val("");
		 $("#pictureFile2").val("");
	}
	function deleteApp(){
		var selectedRows=$("#dg").datagrid("getSelections");
		if(selectedRows.length==0){
			 $.messager.alert("系统提示","请选择要删除的数据！");
			 return;
		 }
		 var ids=selectedRows[0].id;
		 $.messager.confirm("系统提示","您确定要删除这<font color=red>"+selectedRows.length+"</font>条数据吗？",function(r){
				if(r){
					$.post("/admin/app/delete",{id:ids},function(result){
						if(result.success){
							 $.messager.alert("系统提示","数据已成功删除！");
							 $("#dg").datagrid("reload");
						}else{
							$.messager.alert("系统提示",result.errorInfo);
						}
					},"json");
				} 
	   });
	}
	
	function searchApp(){
		$("#dg").datagrid('load',{
			"appName":$("#s_name").val(),
			"btime":$("#s_btime").datetimebox("getValue"),
			"etime":$("#s_etime").datetimebox("getValue")
		});	
	 }
</script>
</head>
<body style="margin: 1px">
<table id="dg" title="客户端管理" class="easyui-datagrid"
   fitColumns="true" pagination="true" rownumbers="true" singleSelect="true"
   url="/admin/app/list" fit="true" toolbar="#tb">
   <thead>
   	<tr>    
   		<th field="id" width="20" align="center">编号</th>
   		<th field="appName" width="100" align="center">客户端名称</th>
   		<th field="appType" width="50" align="center">客户端类别</th>
   		<th field="appVersion" width="50" align="center">客户端版本</th>
   		<th field="appUrl" width="50" align="center">客户端地址</th>
   		<th field="createTime" width="80" align="center" formatter="formatCreateTime">创建时间</th>
   		<th field="remarks" width="50" align="center">备注</th>
   </thead>
 </table>
 
 <div id="tb">
 	<div>
 		<a href="javascript:openAppAddDialog()" class="easyui-linkbutton" iconCls="icon-add" plain="true">添加</a>
 		<a href="javascript:openAppModifyDialog()" class="easyui-linkbutton" iconCls="icon-edit" plain="true">修改</a>
 		<a href="javascript:deleteApp()" class="easyui-linkbutton" iconCls="icon-remove" plain="true">删除</a>
 	</div> 
 	<div>
 		&nbsp;商铺名称：&nbsp;<input type="text" id="s_name" size="20" onkeydown="if(event.keyCode==13) searchShop()"/>
 		&nbsp;&nbsp;创建时间：&nbsp;
	 		<input id="s_btime" class="easyui-datetimebox" editable=false  style="width:150px">
 		&nbsp;&nbsp;-&nbsp;&nbsp;
 		<input id="s_etime" class="easyui-datetimebox" editable=false  style="width:150px">
 		&nbsp;&nbsp;<a href="javascript:searchApp()" class="easyui-linkbutton" iconCls="icon-search" plain="true">搜索</a>
 		&nbsp;&nbsp;<a href="javascript:resetSearchValue()" class="easyui-linkbutton" iconCls="icon-reset" plain="true">重置</a>
 	</div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 </div>
 
 <div id="dlg" class="easyui-dialog" style="width:500px;height:350px;padding: 10px 20px"
   closed="true" buttons="#dlg-buttons" data-options="onClose:function(){resetValue()}">
   
	   <form id="fm" method="post">
	   	<table cellspacing="8px">
	   		<tr>
	   			<td>客户端名称：</td>
	   			<td><input type="text" id="appName" name="appName" class="easyui-validatebox"  required="true" style="width: 250px"/></td>
	   		</tr>
	   		<tr>
	   			<td>客户端类别：</td>
	   			<td>
	   				<select class="easyui-combobox"  id="appType" name="appType" style="width: 250px;" required=true>
						<option value="android" selected>Android</option>
						<option value="ios">IOS</option>
	 				</select>
	   			</td>
	   		</tr>
	   		<tr>
	   			<td>客户端版本：</td>
	   			<td><input type="text" id="appVersion" name="appVersion" class="easyui-validatebox"  required="true" style="width: 250px"/></td>
	   		</tr>
	   		<tr>
	   			<td>备注：</td>
	   			<td>
	   				<textarea rows="5" cols="40" id="remarks" style="width: 250px;" name="remarks"></textarea>
	   			</td>
	   		</tr>
	   		<tr>
	   			<td>选择文件：</td>
	   			<td><input id="pictureFile" name="file"  style="width:250px" type="file" required="true"></td>
	   		</tr>
	   	</table>
	   </form>
 </div>
 <div id="dlg-buttons">
 	<a href="javascript:saveApp()" class="easyui-linkbutton" iconCls="icon-ok">保存</a>
 	<a href="javascript:closeAppDialog()" class="easyui-linkbutton" iconCls="icon-cancel">关闭</a>
 </div>
 <div id="dlg2" class="easyui-dialog" style="width:500px;height:350px;padding: 10px 20px"
   closed="true" buttons="#dlg-buttons2" data-options="onClose:function(){resetValue2()}">
   
	   <form id="fm2" method="post">
	   	<table cellspacing="8px">
	   		<tr>
	   			<td>客户端名称：</td>
	   			<td><input type="text" id="appName2" name="appName" class="easyui-validatebox"  required="true" style="width: 250px"/></td>
	   		</tr>
	   		<tr>
	   			<td>客户端类别：</td>
	   			<td>
	   				<select class="easyui-combobox"  id="appType2" name="appType" style="width: 250px;" required=true>
						<option value="android" selected>Android</option>
						<option value="ios">IOS</option>
	 				</select>
	   			</td>
	   		</tr>
	   		<tr>
	   			<td>客户端版本：</td>
	   			<td><input type="text" id="appVersion2" name="appVersion" class="easyui-validatebox"  required="true" style="width: 250px"/></td>
	   		</tr>
	   		<tr>
	   			<td>备注：</td>
	   			<td>
	   				<textarea rows="5" cols="40" id="remarks2" style="width: 250px;" name="remarks"></textarea>
	   			</td>
	   		</tr>
	   	</table>
	   </form>
 </div>
 <div id="dlg-buttons2">
 	<a href="javascript:saveApp2()" class="easyui-linkbutton" iconCls="icon-ok">保存</a>
 	<a href="javascript:closeAppDialog2()" class="easyui-linkbutton" iconCls="icon-cancel">关闭</a>
 </div>
</body>
</html>