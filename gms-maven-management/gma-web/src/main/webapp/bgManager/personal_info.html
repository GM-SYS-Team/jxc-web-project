<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>后台管理系统</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link href="../static/bgManager/css/shop.css" type="text/css" rel="stylesheet" />
<link href="../static/bgManager/css/Sellerber.css" type="text/css"  rel="stylesheet" />
<link href="../static/bgManager/css/bkg_ui.css" type="text/css"  rel="stylesheet" />
<link href="../static/bgManager/font/css/font-awesome.min.css"  rel="stylesheet" type="text/css" />
<script src="../static/bgManager/js/jquery-1.9.1.min.js" type="text/javascript" ></script>
<script type="text/javascript" src="../static/bgManager/js/jquery.cookie.js"></script>
<script src="../static/bgManager/js/shopFrame.js" type="text/javascript"></script>
<script src="../static/bgManager/js/Sellerber.js" type="text/javascript"></script>
<script src="../static/bgManager/js/layer/layer.js" type="text/javascript"></script>
 <script src="../static/bgManager/js/laydate/laydate.js" type="text/javascript"></script>
 <script type="text/javascript" src="../static/bgManager/js/json2.js"></script>
<script src="../static/bgManager/js/jquery.dataTables.min.js"></script>
<script src="../static/bgManager/js/jquery.dataTables.bootstrap.js"></script>
<title>个人信息</title>
</head>
<style>
	.change_Password { margin-top:20px;}
	.change_Password li{ height:40px; line-height:30px; margin:10px 0px;}
	.change_Password li .label_name{ width:80px; text-align:right; color:#666; float:left}
	.change_Password li .change_text{ float:left; margin-left:10px; width:150px}
</style>
<body>
<div class="margin" id="page_style">
   <div class="personal_info">
   		<div class="add_style clearfix border_style">
		   <form id="user_info" action="" method="post">
		    <input type="hidden" id="id"/>
		    <div class="clearfix">
		        <div class="form-group clearfix col-xs-4">
		        	<label class="col-xs-3 label_name" for="form-field-1">商铺名称：</label>
		         	<div class="col-xs-9 line_height1" id="shopName"></div>         
		         </div>
		         
		         <div class="form-group clearfix col-xs-4">
			        <label class="col-xs-3 label_name" for="form-field-1">经营范围：</label>
			        <div class="col-xs-9 line_height1">
			         	<input type="text" name="business" data-name="经营范围" id="business" value="" class="col-xs-12 text_info"disabled="disabled">
			        </div>         
		         </div>
		         
		          <div class="form-group clearfix col-xs-4">
			        <label class="col-xs-3 label_name" for="form-field-1">联系人：</label>
			        <div class="col-xs-9 line_height1">
			         	<input type="text" name="contactName" data-name="联系人" id="contactName" value="" class="col-xs-12 text_info" disabled="disabled">
			        </div>         
		         </div>
		         
		          <div class="form-group clearfix col-xs-4">
			        <label class="col-xs-3 label_name" for="form-field-1">邮政编码：</label>
			        <div class="col-xs-9 line_height1">
			         	<input type="text" name="contactCode" data-name="邮政编码" id="contactCode" value="" class="col-xs-12 text_info" disabled="disabled">
			        </div>         
		         </div>
		          
		          <div class="form-group clearfix col-xs-4">
			        <label class="col-xs-3 label_name" for="form-field-1">固定电话：</label>
			        <div class="col-xs-9 line_height1">
			         	<input type="text" name="contactNum" data-name="固定电话" id="contactNum" value="" class="col-xs-12 text_info" disabled="disabled">
			        </div>         
		         </div>
		         
		          <div class="form-group clearfix col-xs-4">
			        <label class="col-xs-3 label_name" for="form-field-1">手机号码：</label>
			        <div class="col-xs-9 line_height1">
			         	<input type="text" name="phoneNum" data-name="手机号码" id="phoneNum" value="" class="col-xs-12 text_info" disabled="disabled">
			        </div>         
		         </div>
		         
		          <div class="form-group clearfix col-xs-4">
			        <label class="col-xs-3 label_name" for="form-field-1">商户地址：</label>
			        <div class="col-xs-9 line_height1">
			         	<input type="text" name="shopAddress" data-name="商户地址" id="shopAddress" value="" class="col-xs-12 text_info" disabled="disabled">
			        </div>         
		         </div>
		          
		    </div>
		        
		    <div class="Button_operation clearfix"> 
		         <input type="button" onclick="modify();" class="btn btn-danger operation_btn" id="modify_info"  value="修改信息"/>
		         <input type="button" id="save_info" class="btn bg-deep-blue operation_btn save"  value="保存修改" style="display: none;"/>
		         <a href="javascript:void(0);" onclick="change_Password()" class="btn bg-green operation_btn">修改密码</a>				     
			</div>
			
		   </form>
	 	</div>
	 	<div id="text_name"></div>
   </div>
   
</div>
 <!--修改密码样式-->
     <div class="change_Pass_style display" id="change_Pass">
     	<input type="hidden" id="user_id"/>
        <ul class="change_Password clearfix">
         <li>
         	<label class="label_name">原&nbsp;&nbsp;密&nbsp;码</label>
         	<span class="change_text"><input name="password" data-name="原密码" type="password" class="" id="password"></span>
         </li>
         <li>
         	<label class="label_name">新&nbsp;&nbsp;密&nbsp;码</label>
         	<span class="change_text"><input name="Nes_pas"  data-name="新密码" type="password" class="" id="new_pas"></span>
         </li>
         <li>
         	<label class="label_name">确认密码</label>
         	<span class="change_text"><input name="c_mew_pas" type="password" data-name="再次确认密码" class="" id="c_new_pas"></span>
         </li>              
        </ul>          
     </div>
</body>
</html>
<script>
$(document).ready(function(){
	$.ajax( {
		url : "/admin/shop/currentMap",
		type : "POST",
		data : {
		},
		success : function(data) {
			$("#shopName").html(data.shop.shopName);
			$("#id").val(data.shop.id);
			$("#business").val(data.shop.business);
			$("#contactName").val(data.shop.contactName);
			$("#contactCode").val(data.shop.contactCode);
			$("#contactNum").val(data.shop.contactNum);
			$("#phoneNum").val(data.shop.phoneNum);
			$("#shopAddress").val(data.shop.shopAddress);
			
			$("#user_id").val(data.user.id);
		}
	})
})

/****修改密码****/
function change_Password(){
	layer.open({
    type: 1,
	title:'修改密码',
	area: ['300px','300px'],
	shadeClose: true,
	content: $('#change_Pass'),
	btn:['确认修改'],
	yes:function(index, layero){		
	 	var num=0;
     	var str="";
	 	var $paddword=/^[a-z0-9_-]{5,18}$/;
	
     	$("input[type$='password']").each(function(n){
	          if($(this).val()==""){
				   layer.alert(str+=""+$(this).attr("data-name")+"不能为空！\r\n",{
	                title: '提示框',				
					icon:0,								
	          }); 
			   num++;
	           return false;            
	          } 
		 });
	     if(num>0){  return false;}	
	     if(!$("#c_mew_pas").val || $("#c_new_pas").val() != $("#new_pas").val() ){
            layer.alert('密码不一致!',{
              title: '提示框',				
				icon:0,
			 });
			 return false;
         }else{	
        	var newPassword = $("#new_pas").val();
        	var userId = $("#user_id").val();
         	$.ajax( {
				url : "/admin/user/modifyPassword",
				type : "POST",
				data : {
					id:userId,
					newPassword:newPassword
				},
				success : function(data) {
					if(data.success){
						 layer.alert('修改成功！',{
			              	title: '提示框',				
							icon:1,		
						  }); 
				    	 layer.close(index);
					}
				}
			})
			       
		  }	 
		}
    });
}
/*******滚动条*******/
$("body").niceScroll({  
	cursorcolor:"#888888",  
	cursoropacitymax:1,  
	touchbehavior:false,  
	cursorwidth:"5px",  
	cursorborder:"0",  
	cursorborderradius:"5px"  
});

/********个人信息操作*******/
function modify(){
	 $('.text_info').attr("disabled", false);
	 $('.text_info').addClass("add");
	 $('#page_style').find('.add_style').addClass("hover");
	 //$('#page_style').find('.save').css({'display':'block'});
	 $("#modify_info").hide();
	 $("#save_info").show();
};

/********修改店铺信息*******/
$("#save_info").click(function(){
     var num=0;
	 var str="";
	 var params=$('input').serialize(); //序列化表单的值
   	 $(".xinxi input[type$='text']").each(function(n){
          if($(this).val()==""){
			   layer.alert(str+=""+$(this).attr("name")+"不能为空！\r\n",{
	                title: '提示框',				
					icon:0,								
	            }); 
		    	num++;
            	return false;            
          } 
	 });
	  if(num>0){  return false;}	 	
         else{
		   $.ajax({
			   type:"post",
			   url:"",
			   dataType:"json",
			   data:params,
			   success:User_Info  		  
			  });
			  function User_Info(json){
				  var str="姓名:"+json.username+"<br />";
					  str+="年龄:"+json.age+"<br />";
					  str+="性别:"+json.sex+"<br />";
					  str+="工作:"+json.mailbox+"<br />";
					  str+="追加测试:"+json.phone;						  
					  $("#text_name").html(str);				  					  				  
				 }
		   layer.alert('修改成功！',{
              title: '提示框',				
		   icon:1,			   		
		  });
		  $('#page_style').find('.add_style').removeClass("hover");
		  $('#page_style').find('.text_info').removeClass("add").attr("disabled", true);
		  $('#page_style').find('.save').css({'display':'none'});
		  layer.close();			
	  }
});
</script>
